!function(a){var b,c,d={};b=function(a){this.methods=[{name:"get",query:!0},{name:"post",body:!0},{name:"put",body:!0},{name:"delete",query:!0},{name:"head",query:!0}],this.basepath=a,this.reqHeaders={},this.options={charset:"utf-8",autoParse:!0,timeout:3e4,cors:!1,corsWithCredentials:!1},this.setupMethodHandlers(),this.promiseLib=this.detectPromise()},b.prototype.header=function(a){return"object"==typeof a&&(this.reqHeaders=a),this},b.prototype.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&this.options.hasOwnProperty(b)&&(this.options[b]=a[b]);return this},b.prototype.setupMethodHandlers=function(){for(var a in this.methods)!function(a,b){a[b.name]=function(d){return new c(a,b,d)}}(this,this.methods[a])},b.prototype.detectPromise=function(){try{var a=[window.Promise,window.Q,window.assure,window.Promiz,window.Y];for(var b in a){var c=a[b];if(c&&c.defer)return c}}catch(d){}return void 0},b.prototype.send=function(a){var b=this,e=function(e,f){if(!(a&&a instanceof c))throw new Error("Invalid send parameters");var g=b.basepath;g||(g=""),a.path&&(g=d.joinPaths(b.basepath,a.path)),a._query&&(g+=d.buildQueryString(a._query));var h=d.buildXHR(b.options.cors,b.options.corsWithCredentials);h.open(a.method.name,g,!0);var i=d.buildHeaders(b.reqHeaders,a.reqHeaders,typeof a._body,b.options.charset);for(var j in i)i.hasOwnProperty(j)&&h.setRequestHeader(j,i[j]);var k=setTimeout(function(){h.abort(),f&&b.promiseLib?f({body:"A network timeout has occurred",status:0}):f&&f("A network timeout has occurred",0)},b.options.timeout);h.onerror=function(){clearTimeout(k),f&&b.promiseLib?f({body:"A network-level exception has occurred",status:0}):f&&f("A network-level exception has occurred",0)},h.onreadystatechange=function(){if(clearTimeout(k),4===h.readyState){var a=d.parseResponseHeaders(h.getAllResponseHeaders(),b.options.autoParse),c=d.parseResponseBody(h.responseText,a,b.options.autoParse),g=h.status>=100&&h.status<300||304===h.status?e:f;g&&0!==h.status&&b.promiseLib?g({body:c,status:h.status,headers:a}):g&&0!==h.status&&g(c,h.status,a)}};try{a._body&&"object"==typeof a._body?h.send(JSON.stringify(a._body)):a._body&&"string"==typeof a._body?h.send(a._body):h.send()}catch(l){f&&b.promiseLib?f({body:l,status:0}):f&&f(l,0)}};if(this.promiseLib){var f=this.promiseLib.defer();return e(f.resolve,f.reject),f.promise}e(a.onSuccess,a.onError)},c=function(a,b,c){this.d=a,this.method=b,this.path=c},c.prototype.header=function(a){return"object"==typeof a&&(this.reqHeaders=a),this},c.prototype.query=function(a){return!this.method.query||"object"!=typeof a&&"string"!=typeof a||(this._query=a),this},c.prototype.body=function(a){return!this.method.body||"object"!=typeof a&&"string"!=typeof a||(this._body=a),this},c.prototype.success=function(a){return this.onSuccess=a,this},c.prototype.error=function(a){return this.onError=a,this},c.prototype.send=function(){var a=this;return function(){return a.d.send(a)}()},d.buildXHR=function(a,b){if(a&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;var c=new XMLHttpRequest;if(a&&!("withCredentials"in c))throw new Error("CORS is not supported by this user agent");return a&&b&&"withCredentials"in c&&(c.withCredentials="true"),c},d.buildHeaders=function(a,b,c,d){var e={};for(var f in a)a.hasOwnProperty(f)&&(e[f]=a[f]);"object"===c?e["Content-Type"]="application/json":"string"===c&&(e["Content-Type"]="text/html; charset="+d);for(var g in b)b.hasOwnProperty(g)&&(e[g]=b[g]);return e},d.buildQueryString=function(a){if("string"==typeof a&&/^[?](?:(?:(?!=[^?&=])&|(?:[^?&=]+=[^?&=]+))+)*$/.test(a))return a;if("string"==typeof a&&/^(?:(?:(?!=[^?&=])&|(?:[^?&=]+=[^?&=]+))+)*$/.test(a))return"?"+a;if("object"==typeof a&&Object.keys(a).length>0){var b="";for(var c in a)a.hasOwnProperty(c)&&(b&&(b+="&"),b=b+encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return"?"+b}return""},d.parseResponseHeaders=function(a,b){var c=a;if(b)try{var d={},e=a.replace(/\r\n/g,"\n").split("\n");for(var f in e)if(""!==e[f]){var g=e[f].trim(),h=g.split(":");d[h[0].trim()]=h[1].trim()}c=d}catch(i){console.error("Unable to parse response headers")}return c},d.parseResponseBody=function(a,b,c){var d=a;if(c&&("object"==typeof b&&"Content-Type"in b&&b["Content-Type"].indexOf("application/json")>-1||"string"==typeof b&&/^Content-Type:.*application\/json.*$/m.test(b)))try{d=JSON.parse(d)}catch(e){console.error("Unable to parse response body")}return d},d.joinPaths=function(){var a=Array.prototype.slice.call(arguments),b=[];for(var c in a){a[c]&&"object"!=typeof a[c]&&"function"!=typeof a[c]?"string"!=typeof a[c]?a[c]=""+a[c]:/.+\?.*/.test(a[c])&&(a[c]=a[c].match(/(.+)\?.*/)[1]):a[c]="";var d=a[c].match(/((?:[a-zA-Z]+:\/\/)?[^\/?&=]+)/g);d&&d.length>0&&Array.prototype.push.apply(b,d)}var e=b.join("/");return/[a-zA-Z]+:\/\/.+/.test(e)?e:"/"+e},b._support={Request:c,Utilities:d},"function"==typeof define?define(function(){return b}):a.Discuss=b}(this);